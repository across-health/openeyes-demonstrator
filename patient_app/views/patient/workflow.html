<div class="row panel callout radius">
  <div class="small-2 columns">
    {{episode.subSpecialty}}
  </div>
  <div class="small-4 columns">
    {{episode.startDate | date:'MMM dd, yyyy'}} -
    <span ng-show="episode.endDate != ''">{{episode.endDate | date:'MMM dd, yyyy'}}</span>
    <span ng-show="episode.endDate == ''"><em>outstanding</em></span>
  </div>
  <div class="small-2 columns">
    <span class="static-label">Eye: </span>{{episode.eye}}
  </div>
  <div class="small-4 columns">
    <span class="static-label">Diagnosis: </span>{{episode.diagnosis}}
  </div>
</div>

<!-- You need to create three elements to house the toolbox (Add Stage + Save buttons), the workspace (where you draw the shapes) and the editor (a form for editing details about a shape) -->
<!-- You will reference these below in the JavaScript -->
<a href="#/episode/{{episode.id}}">Back</a>
<div class="toolbox" id="toolbox"></div>
<div class="workspace" id="workspace"></div>
<div class="editor" id="editor"></div>


<script src="/javascripts/workflow_templates.js" type="text/javascript"></script>
<script src="/javascripts/workflow.js" type="text/javascript"></script>
      <script type="text/javascript">
        $(document).ready(function() {
          workspace.initialize({
            workspace: $('#workspace'), // jQuery object for the HTML element that you want to be the workspace - the area where you draw the shapes.
            editor: $('#editor'), // jQuery object for the HTML element that you want to be the editor - the area where a form gets rendered to set the name and description of a stage/transition.
            toolbox: $('#toolbox'), // jQuery object for the HTML element that you want to be the workspace - the area where the 'Add Stage' and 'Save' buttons get rendered.
            save: function(workflow_json) { // A callback function that is called when you click the 'Save' button in the toolbox. workflow_json is the full JSON of the workflow. `this` refers to the workspace object. `this.toJSON()` will return the workflow in JSON form (i.e. not a string). `this.stage_list` will return all the stages. `this.transition_list` will return all the transitions.
              // Below is an example, you can put AJAX or something here to save it.
              console.log(JSON.stringify(workflow_json));
              console.log(this);
            }
            // Uncomment/populate line below to provide initial data for the workflow editor to render.
            // , initial_data: {"workflow":{"stage_list":[{"id":"stage446354","name":"Start","description":"This is the initial stage.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage446354","epTargetBottomCenterUUID":"epTargetBottomCenter-stage446354","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage446354","epTargetRightMiddleUUID":"epTargetRightMiddle-stage446354","epSourceTopCenterUUID":"epSourceTopCenter-stage446354","epSourceBottomCenterUUID":"epSourceBottomCenter-stage446354","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage446354","epSourceRightMiddleUUID":"epSourceRightMiddle-stage446354","posX":360,"posY":20},{"id":"stage766857","name":"Referral","description":"Patient is referred to hospital.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage766857","epTargetBottomCenterUUID":"epTargetBottomCenter-stage766857","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage766857","epTargetRightMiddleUUID":"epTargetRightMiddle-stage766857","epSourceTopCenterUUID":"epSourceTopCenter-stage766857","epSourceBottomCenterUUID":"epSourceBottomCenter-stage766857","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage766857","epSourceRightMiddleUUID":"epSourceRightMiddle-stage766857","posX":360,"posY":160},{"id":"stage350827","name":"End","description":"This is the final stage.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage350827","epTargetBottomCenterUUID":"epTargetBottomCenter-stage350827","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage350827","epTargetRightMiddleUUID":"epTargetRightMiddle-stage350827","epSourceTopCenterUUID":"epSourceTopCenter-stage350827","epSourceBottomCenterUUID":"epSourceBottomCenter-stage350827","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage350827","epSourceRightMiddleUUID":"epSourceRightMiddle-stage350827","posX":360,"posY":480},{"id":"stage402170","name":"Consultation","description":"The patient is being consulted.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage402170","epTargetBottomCenterUUID":"epTargetBottomCenter-stage402170","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage402170","epTargetRightMiddleUUID":"epTargetRightMiddle-stage402170","epSourceTopCenterUUID":"epSourceTopCenter-stage402170","epSourceBottomCenterUUID":"epSourceBottomCenter-stage402170","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage402170","epSourceRightMiddleUUID":"epSourceRightMiddle-stage402170","posX":360,"posY":360}],"transition_list":[{"id":"con_75","name":"Begin","description":"This transition always fires automatically.","sourceStageId":"stage446354","targetStageId":"stage766857","sourceEndpoint":"epSourceBottomCenter-stage446354","targetEndpoint":"epTargetTopCenter-stage766857","reassignmentType":"current_user","reassignmentGroup":"","reassignmentUser":""},{"id":"con_83","name":"Requires Consultation","description":"This patient requires a consultation, send them to a doctor.","sourceStageId":"stage766857","targetStageId":"stage402170","sourceEndpoint":"epSourceBottomCenter-stage766857","targetEndpoint":"epTargetTopCenter-stage402170","reassignmentGroup":"","reassignmentUser":""},{"id":"con_91","name":"Consultation Complete","description":"Consultation has been carried out. Send patient home.","sourceStageId":"stage402170","targetStageId":"stage350827","sourceEndpoint":"epSourceBottomCenter-stage402170","targetEndpoint":"epTargetTopCenter-stage350827","reassignmentGroup":"","reassignmentUser":""},{"id":"con_99","name":"No Consultation Required","description":"This patient doesnt require a consultation.","sourceStageId":"stage766857","targetStageId":"stage350827","sourceEndpoint":"epSourceRightMiddle-stage766857","targetEndpoint":"epTargetRightMiddle-stage350827","reassignmentGroup":"","reassignmentUser":""}]}}
            // , initial_data: {"workflow":{"stage_list":[{"id":"stage446354","name":"Start","description":"This is the initial stage.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage446354","epTargetBottomCenterUUID":"epTargetBottomCenter-stage446354","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage446354","epTargetRightMiddleUUID":"epTargetRightMiddle-stage446354","epSourceTopCenterUUID":"epSourceTopCenter-stage446354","epSourceBottomCenterUUID":"epSourceBottomCenter-stage446354","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage446354","epSourceRightMiddleUUID":"epSourceRightMiddle-stage446354","posX":20,"posY":20},{"id":"stage766857","name":"Consultation","description":"Patient is referred to hospital.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage766857","epTargetBottomCenterUUID":"epTargetBottomCenter-stage766857","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage766857","epTargetRightMiddleUUID":"epTargetRightMiddle-stage766857","epSourceTopCenterUUID":"epSourceTopCenter-stage766857","epSourceBottomCenterUUID":"epSourceBottomCenter-stage766857","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage766857","epSourceRightMiddleUUID":"epSourceRightMiddle-stage766857","posX":20,"posY":180},{"id":"stage350827","name":"End","description":"This is the final stage.","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage350827","epTargetBottomCenterUUID":"epTargetBottomCenter-stage350827","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage350827","epTargetRightMiddleUUID":"epTargetRightMiddle-stage350827","epSourceTopCenterUUID":"epSourceTopCenter-stage350827","epSourceBottomCenterUUID":"epSourceBottomCenter-stage350827","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage350827","epSourceRightMiddleUUID":"epSourceRightMiddle-stage350827","posX":640,"posY":360},{"id":"stage402170","name":"Listing","description":"listing","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage402170","epTargetBottomCenterUUID":"epTargetBottomCenter-stage402170","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage402170","epTargetRightMiddleUUID":"epTargetRightMiddle-stage402170","epSourceTopCenterUUID":"epSourceTopCenter-stage402170","epSourceBottomCenterUUID":"epSourceBottomCenter-stage402170","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage402170","epSourceRightMiddleUUID":"epSourceRightMiddle-stage402170","posX":20,"posY":360},{"id":"stage219996","name":"Consent","description":"consent","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage219996","epTargetBottomCenterUUID":"epTargetBottomCenter-stage219996","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage219996","epTargetRightMiddleUUID":"epTargetRightMiddle-stage219996","epSourceTopCenterUUID":"epSourceTopCenter-stage219996","epSourceBottomCenterUUID":"epSourceBottomCenter-stage219996","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage219996","epSourceRightMiddleUUID":"epSourceRightMiddle-stage219996","posX":340,"posY":20},{"id":"stage527901","name":"Biometry measurement","description":"","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage527901","epTargetBottomCenterUUID":"epTargetBottomCenter-stage527901","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage527901","epTargetRightMiddleUUID":"epTargetRightMiddle-stage527901","epSourceTopCenterUUID":"epSourceTopCenter-stage527901","epSourceBottomCenterUUID":"epSourceBottomCenter-stage527901","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage527901","epSourceRightMiddleUUID":"epSourceRightMiddle-stage527901","posX":340,"posY":180},{"id":"stage972515","name":"Surgery","description":"","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage972515","epTargetBottomCenterUUID":"epTargetBottomCenter-stage972515","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage972515","epTargetRightMiddleUUID":"epTargetRightMiddle-stage972515","epSourceTopCenterUUID":"epSourceTopCenter-stage972515","epSourceBottomCenterUUID":"epSourceBottomCenter-stage972515","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage972515","epSourceRightMiddleUUID":"epSourceRightMiddle-stage972515","posX":340,"posY":360},{"id":"stage386249","name":"Follow up","description":"","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage386249","epTargetBottomCenterUUID":"epTargetBottomCenter-stage386249","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage386249","epTargetRightMiddleUUID":"epTargetRightMiddle-stage386249","epSourceTopCenterUUID":"epSourceTopCenter-stage386249","epSourceBottomCenterUUID":"epSourceBottomCenter-stage386249","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage386249","epSourceRightMiddleUUID":"epSourceRightMiddle-stage386249","posX":640,"posY":20},{"id":"stage278018","name":"Discharge","description":"","status":"OK","epTargetTopCenterUUID":"epTargetTopCenter-stage278018","epTargetBottomCenterUUID":"epTargetBottomCenter-stage278018","epTargetLeftMiddleUUID":"epTargetLeftMiddle-stage278018","epTargetRightMiddleUUID":"epTargetRightMiddle-stage278018","epSourceTopCenterUUID":"epSourceTopCenter-stage278018","epSourceBottomCenterUUID":"epSourceBottomCenter-stage278018","epSourceLeftMiddleUUID":"epSourceLeftMiddle-stage278018","epSourceRightMiddleUUID":"epSourceRightMiddle-stage278018","posX":640,"posY":180}],"transition_list":[{"id":"con_65","name":"Begin","description":"This transition always fires automatically.","sourceStageId":"stage446354","targetStageId":"stage766857","sourceEndpoint":"epSourceBottomCenter-stage446354","targetEndpoint":"epTargetTopCenter-stage766857","reassignmentType":"current_user","reassignmentGroup":"","reassignmentUser":""},{"id":"con_67","name":"Consultation complete","description":"This patient requires a consultation, send them to a doctor.","sourceStageId":"stage766857","targetStageId":"stage402170","sourceEndpoint":"epSourceBottomCenter-stage766857","targetEndpoint":"epTargetTopCenter-stage402170"},{"id":"con_203","name":"Listing complete","description":"","sourceStageId":"stage402170","targetStageId":"stage219996","sourceEndpoint":"epSourceRightMiddle-stage402170","targetEndpoint":"epTargetLeftMiddle-stage219996"},{"id":"con_211","name":"Consent complete","description":"","sourceStageId":"stage219996","targetStageId":"stage527901","sourceEndpoint":"epSourceBottomCenter-stage219996","targetEndpoint":"epTargetTopCenter-stage527901"},{"id":"con_147","name":"Measurement complete","description":"","sourceStageId":"stage527901","targetStageId":"stage972515","sourceEndpoint":"epSourceBottomCenter-stage527901","targetEndpoint":"epTargetTopCenter-stage972515"},{"id":"con_219","name":"Surgery complete","description":"","sourceStageId":"stage972515","targetStageId":"stage386249","sourceEndpoint":"epSourceRightMiddle-stage972515","targetEndpoint":"epTargetLeftMiddle-stage386249"},{"id":"con_227","name":"Follow up complete","description":"","sourceStageId":"stage386249","targetStageId":"stage278018","sourceEndpoint":"epSourceBottomCenter-stage386249","targetEndpoint":"epTargetTopCenter-stage278018"},{"id":"con_235","name":"Discharge complete","description":"","sourceStageId":"stage278018","targetStageId":"stage350827","sourceEndpoint":"epSourceBottomCenter-stage278018","targetEndpoint":"epTargetTopCenter-stage350827"}]}}
            , initial_data: window.rawWorkflow

            // Alternatively - dont use initial_data and call workspace.fromJSON() passing to it the JSON you want to render as per the format above.
          });
          // console.log(JSON.stringify(window.rawWorkflow));
          // workspace.fromJSON(JSON.stringify(window.rawWorkflow));
        });
      </script>
workflow